# Special Pages

Preact-based HTML/CSS/JS applications embedded in DuckDuckGo browsers. Each page is an isolated app with privileged native API access.

## Structure

```
pages/<name>/
├── app/              # Preact components (App.jsx, *.module.css)
├── src/index.js      # Page class with messaging methods  
├── messages/         # JSON schemas → auto-generates types/
├── types/<name>.ts   # Generated types (DO NOT EDIT)
├── public/           # Static assets, index.html, locales/
└── integration-tests/
```

**Shared code:** `shared/` contains reusable components (`Button`, `Card`, `Switch`, `Text`), `Environment` class, `TranslationProvider`, and `createSpecialPageMessaging()`.

## Messaging Pattern

Pages communicate with native via `@duckduckgo/messaging`. Define schemas in `messages/`:
- `*.request.json` + `*.response.json` → async request/response
- `*.notify.json` → fire-and-forget notification
- `*.subscribe.json` → push-based subscription

## TypeScript

JSDoc types in JavaScript files. Import types via `@typedef` after imports:

```javascript
/** @typedef {import('./types.js').MyType} MyType */
```

## Styling

- Use CSS Modules (`*.module.css`)
- Global styles: `shared/styles/`

## Testing

Run from `special-pages/` directory:

| Command | Purpose |
|---------|---------|
| `npm run test-unit` | Unit tests |
| `npm run test-int` | Integration tests (all platforms) |
| `npm run test-int -- --project ios` | Single platform |
| `npm run test.screenshots` | Screenshot tests only |

Integration tests use Page Object pattern—see `integration-tests/<name>.js` for helpers.

Top-level commands (`npm run build`, `npm run lint`) also work from this directory.

## Notes

- When running Playwright commands, use `--reporter list` to prevent the Shell tool from hanging
- Types in `types/` are auto-generated from `messages/` schemas—never edit manually
