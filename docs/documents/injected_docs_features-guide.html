<!DOCTYPE html><html class="default" lang="en" data-base="../"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>injected/docs/features-guide | @duckduckgo/content-scope-scripts</title><meta name="description" content="Documentation for @duckduckgo/content-scope-scripts"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => window.app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><a href="../index.html" class="title">@duckduckgo/content-scope-scripts</a><div id="tsd-toolbar-links"></div><button id="tsd-search-trigger" class="tsd-widget" aria-label="Search"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></button><dialog id="tsd-search" aria-label="Search"><input role="combobox" id="tsd-search-input" aria-controls="tsd-search-results" aria-autocomplete="list" aria-expanded="true" autocapitalize="off" autocomplete="off" placeholder="Search the docs" maxLength="100"/><ul role="listbox" id="tsd-search-results"></ul><div id="tsd-search-status" aria-live="polite" aria-atomic="true"><div>Preparing search index...</div></div></dialog><a href="#" class="tsd-widget menu" id="tsd-toolbar-menu-trigger" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb" aria-label="Breadcrumb"><li><a href="" aria-current="page">injected/docs/features-guide</a></li></ul></div><div class="tsd-panel tsd-typography"><h1 id="features-development-guide" class="tsd-anchor-link">Features Development Guide<a href="#features-development-guide" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1>
<h2 id="overview" class="tsd-anchor-link">Overview<a href="#overview" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2>
<p>Features are files stored in the <code>features/</code> directory that must include an <code>init</code> function and optionally <code>update</code> and <code>load</code> methods as explained in the <a href="#features-lifecycle">Features Lifecycle</a>.</p>
<h2 id="configfeature-class" class="tsd-anchor-link">ConfigFeature Class<a href="#configfeature-class" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2>
<p>The <a href="https://github.com/duckduckgo/content-scope-scripts/blob/main/injected/src/config-feature.js">ConfigFeature</a> class is extended by each feature to implement remote config handling. It provides the following methods:</p>
<h3 id="_" class="tsd-anchor-link"><code>getFeatureSettingEnabled(settingKeyName)</code><a href="#_" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3>
<p>For simple boolean settings, returns <code>true</code> if the setting is 'enabled'</p>
<p>For default Enabled use: <code>this.getFeatureSettingEnabled(settingKeyName, 'enabled')</code></p>
<h3 id="_-1" class="tsd-anchor-link"><code>getFeatureSetting()</code><a href="#_-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3>
<p>Returns a specific setting from the feature settings</p>
<h3 id="_-2" class="tsd-anchor-link"><code>recomputeSiteObject()</code><a href="#_-2" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3>
<p>Recomputes the site object for the feature, e.g. when the URL has changed</p>
<p>The <code>ConfigFeature</code> class is also exportable and can be used by other scripts to build C-S-S like features that can handle remote configuration - currently used in <a href="https://github.com/duckduckgo/duckduckgo-autofill/blob/main/src/site-specific-feature.js">autofill.js</a> to handle site specific autofill rules.</p>
<h2 id="implementing-a-new-feature" class="tsd-anchor-link">Implementing a New Feature<a href="#implementing-a-new-feature" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2>
<h3 id="1-create-feature-file" class="tsd-anchor-link">1. Create Feature File<a href="#1-create-feature-file" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3>
<p>Create a new content scope features file in <code>src/features/</code> and register it in <a href="../media/features.js">features.js</a>.</p>
<h3 id="2-register-the-feature" class="tsd-anchor-link">2. Register the Feature<a href="#2-register-the-feature" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3>
<p>Add the feature name to the <a href="../media/features.js">features.js</a> array.</p>
<h3 id="3-add-debug-flags" class="tsd-anchor-link">3. Add Debug Flags<a href="#3-add-debug-flags" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3>
<p>Add breakage debug flags at appropriate places by calling <code>ContentFeature.addDebugFlag()</code>. This will help identify anomalies in breakage reports.</p>
<h3 id="4-write-tests" class="tsd-anchor-link">4. Write Tests<a href="#4-write-tests" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3>
<ul>
<li><strong>Unit tests</strong>: Should be platform agnostic</li>
<li><strong>Integration tests</strong>: Should be platform agnostic and run in the platform also</li>
</ul>
<h3 id="5-follow-process-guidelines" class="tsd-anchor-link">5. Follow Process Guidelines<a href="#5-follow-process-guidelines" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3>
<h2 id="features-lifecycle" class="tsd-anchor-link">Features Lifecycle<a href="#features-lifecycle" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2>
<p>There are three stages that the content scope code is hooked into the platform:</p>
<h3 id="_-3" class="tsd-anchor-link"><code>load</code><a href="#_-3" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3>
<ul>
<li>This should be reserved for work that could cause a delay in loading the feature</li>
<li>Given the current limitations of how we inject our code, we don't have the Privacy Remote Configuration exceptions, so authors should be wary of actually loading anything that would modify the page (and potentially breaking it)</li>
<li>This limitation may be re-addressed in manifest v3</li>
<li>One exception here is the first party cookie protections that are triggered on init to prevent race conditions</li>
</ul>
<h3 id="_-4" class="tsd-anchor-link"><code>init</code><a href="#_-4" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3>
<ul>
<li>This is the main place that features are actually loaded into the extension</li>
</ul>
<h3 id="_-5" class="tsd-anchor-link"><code>update</code><a href="#_-5" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3>
<ul>
<li>This allows the feature to be sent updates from the browser</li>
<li>If this is triggered before init, these updates will be queued and triggered straight after</li>
</ul>
<h2 id="debug-and-breakage-management" class="tsd-anchor-link">Debug and Breakage Management<a href="#debug-and-breakage-management" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2>
<h3 id="debug-implementation" class="tsd-anchor-link">Debug Implementation<a href="#debug-implementation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3>
<p>When developing features that modify web pages, add debug flags at appropriate times to help identify anomalies in breakage reports:</p>
<pre><code class="javascript"><span class="hl-4">ContentFeature</span><span class="hl-2">.</span><span class="hl-3">addDebugFlag</span><span class="hl-2">();</span>
</code><button type="button">Copy</button></pre>

<h3 id="breakage-understanding" class="tsd-anchor-link">Breakage Understanding<a href="#breakage-understanding" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3>
<p><strong>Key principles for feature development:</strong></p>
<ul>
<li>Breakage is unpredictable - expect it rather than hope for the best</li>
<li>Exposing features to the web platform can have permanent impact</li>
<li>Removing features that pages depend on is difficult</li>
<li>Any web page modification impacts performance or security</li>
<li>Modifications to <code>window</code> or other globals should be avoided (pages could define same names)</li>
</ul>
<h3 id="remote-configuration" class="tsd-anchor-link">Remote Configuration<a href="#remote-configuration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3>
<p>All features that modify web pages should use Privacy Remote Configuration where feasible. This allows:</p>
<ul>
<li>Mitigating breakage remotely</li>
<li>Adjusting and disabling feature behavior without browser updates</li>
<li>Monitoring and controlling feature rollout</li>
</ul>
<p>The <code>ConfigFeature</code> class provides the infrastructure for this through <code>getFeatureSettingEnabled()</code> and <code>getFeatureSetting()</code> methods.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h3>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h3>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#features-development-guide"><span>Features <wbr/>Development <wbr/>Guide</span></a><ul><li><a href="#overview"><span>Overview</span></a></li><li><a href="#configfeature-class"><span>Config<wbr/>Feature <wbr/>Class</span></a></li><li><ul><li><a href="#_"><span></span></a></li><li><a href="#_-1"><span></span></a></li><li><a href="#_-2"><span></span></a></li></ul></li><li><a href="#implementing-a-new-feature"><span>Implementing a <wbr/>New <wbr/>Feature</span></a></li><li><ul><li><a href="#1-create-feature-file"><span>1. <wbr/>Create <wbr/>Feature <wbr/>File</span></a></li><li><a href="#2-register-the-feature"><span>2. <wbr/>Register the <wbr/>Feature</span></a></li><li><a href="#3-add-debug-flags"><span>3. <wbr/>Add <wbr/>Debug <wbr/>Flags</span></a></li><li><a href="#4-write-tests"><span>4. <wbr/>Write <wbr/>Tests</span></a></li><li><a href="#5-follow-process-guidelines"><span>5. <wbr/>Follow <wbr/>Process <wbr/>Guidelines</span></a></li></ul></li><li><a href="#features-lifecycle"><span>Features <wbr/>Lifecycle</span></a></li><li><ul><li><a href="#_-3"><span></span></a></li><li><a href="#_-4"><span></span></a></li><li><a href="#_-5"><span></span></a></li></ul></li><li><a href="#debug-and-breakage-management"><span>Debug and <wbr/>Breakage <wbr/>Management</span></a></li><li><ul><li><a href="#debug-implementation"><span>Debug <wbr/>Implementation</span></a></li><li><a href="#breakage-understanding"><span>Breakage <wbr/>Understanding</span></a></li><li><a href="#remote-configuration"><span>Remote <wbr/>Configuration</span></a></li></ul></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../index.html">@duckduckgo/content-scope-scripts</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
