<!DOCTYPE html><html class="default" lang="en" data-base="../"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>injected/docs/test-pages-guide | @duckduckgo/content-scope-scripts</title><meta name="description" content="Documentation for @duckduckgo/content-scope-scripts"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => window.app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><a href="../index.html" class="title">@duckduckgo/content-scope-scripts</a><div id="tsd-toolbar-links"></div><button id="tsd-search-trigger" class="tsd-widget" aria-label="Search"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></button><dialog id="tsd-search" aria-label="Search"><input role="combobox" id="tsd-search-input" aria-controls="tsd-search-results" aria-autocomplete="list" aria-expanded="true" autocapitalize="off" autocomplete="off" placeholder="Search the docs" maxLength="100"/><ul role="listbox" id="tsd-search-results"></ul><div id="tsd-search-status" aria-live="polite" aria-atomic="true"><div>Preparing search index...</div></div></dialog><a href="#" class="tsd-widget menu" id="tsd-toolbar-menu-trigger" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb" aria-label="Breadcrumb"><li><a href="" aria-current="page">injected/docs/test-pages-guide</a></li></ul></div><div class="tsd-panel tsd-typography"><h1 id="test-pages-guide" class="tsd-anchor-link">Test Pages Guide<a href="#test-pages-guide" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1>
<h2 id="overview" class="tsd-anchor-link">Overview<a href="#overview" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2>
<p>The test-pages system is a comprehensive testing framework for Content Scope Scripts that validates feature functionality across different platforms (Android, Apple, Windows, and browser extensions). These test pages are shared by clients and can be run both in browsers and in CI environments.</p>
<h2 id="architecture" class="tsd-anchor-link">Architecture<a href="#architecture" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2>
<h3 id="directory-structure" class="tsd-anchor-link">Directory Structure<a href="#directory-structure" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3>
<pre><code><span class="hl-4">injected</span><span class="hl-2">/</span><span class="hl-4">integration</span><span class="hl-2">-</span><span class="hl-4">test</span><span class="hl-2">/</span><span class="hl-4">test</span><span class="hl-2">-</span><span class="hl-4">pages</span><span class="hl-2">/</span><br/><span class="hl-2">├── </span><span class="hl-4">index</span><span class="hl-2">.</span><span class="hl-4">html</span><span class="hl-2">                    # </span><span class="hl-4">Main</span><span class="hl-2"> </span><span class="hl-4">entry</span><span class="hl-2"> </span><span class="hl-4">point</span><br/><span class="hl-2">├── </span><span class="hl-4">blank</span><span class="hl-2">.</span><span class="hl-4">html</span><span class="hl-2">                    # </span><span class="hl-4">Minimal</span><span class="hl-2"> </span><span class="hl-4">page</span><span class="hl-2"> </span><span class="hl-4">for</span><span class="hl-2"> </span><span class="hl-4">extension</span><span class="hl-2"> </span><span class="hl-4">testing</span><br/><span class="hl-2">├── </span><span class="hl-4">shared</span><span class="hl-2">/                       # </span><span class="hl-4">Shared</span><span class="hl-2"> </span><span class="hl-4">utilities</span><span class="hl-2"> </span><span class="hl-4">and</span><span class="hl-2"> </span><span class="hl-4">styles</span><br/><span class="hl-2">│   ├── </span><span class="hl-4">utils</span><span class="hl-2">.</span><span class="hl-4">js</span><span class="hl-2">                  # </span><span class="hl-4">Test</span><span class="hl-2"> </span><span class="hl-4">framework</span><span class="hl-2"> </span><span class="hl-4">utilities</span><br/><span class="hl-2">│   ├── </span><span class="hl-4">style</span><span class="hl-2">.</span><span class="hl-4">css</span><span class="hl-2">                 # </span><span class="hl-4">Common</span><span class="hl-2"> </span><span class="hl-4">styling</span><br/><span class="hl-2">│   └── ...</span><br/><span class="hl-2">├── {</span><span class="hl-4">feature</span><span class="hl-2">-</span><span class="hl-4">name</span><span class="hl-2">}/               # </span><span class="hl-4">Feature</span><span class="hl-2">-</span><span class="hl-4">specific</span><span class="hl-2"> </span><span class="hl-4">test</span><span class="hl-2"> </span><span class="hl-4">directories</span><br/><span class="hl-2">│   ├── </span><span class="hl-4">index</span><span class="hl-2">.</span><span class="hl-4">html</span><span class="hl-2">                # </span><span class="hl-4">Feature</span><span class="hl-2"> </span><span class="hl-4">test</span><span class="hl-2"> </span><span class="hl-4">index</span><br/><span class="hl-2">│   ├── </span><span class="hl-4">pages</span><span class="hl-2">/                    # </span><span class="hl-4">Individual</span><span class="hl-2"> </span><span class="hl-4">test</span><span class="hl-2"> </span><span class="hl-4">pages</span><br/><span class="hl-2">│   │   └── {</span><span class="hl-4">test</span><span class="hl-2">-</span><span class="hl-4">name</span><span class="hl-2">}.</span><span class="hl-4">html</span><span class="hl-2">      # </span><span class="hl-4">Test</span><span class="hl-2"> </span><span class="hl-4">page</span><span class="hl-2"> </span><span class="hl-4">implementations</span><br/><span class="hl-2">│   ├── </span><span class="hl-4">config</span><span class="hl-2">/                   # </span><span class="hl-4">Feature</span><span class="hl-2"> </span><span class="hl-4">configurations</span><br/><span class="hl-2">│   │   └── {</span><span class="hl-4">config</span><span class="hl-2">-</span><span class="hl-4">name</span><span class="hl-2">}.</span><span class="hl-4">json</span><span class="hl-2">    # </span><span class="hl-5">JSON</span><span class="hl-2"> </span><span class="hl-4">configuration</span><span class="hl-2"> </span><span class="hl-4">files</span><br/><span class="hl-2">│   └── </span><span class="hl-4">scripts</span><span class="hl-2">/                  # </span><span class="hl-4">Additional</span><span class="hl-2"> </span><span class="hl-4">test</span><span class="hl-2"> </span><span class="hl-3">scripts</span><span class="hl-2"> (</span><span class="hl-4">optional</span><span class="hl-2">)</span><br/><span class="hl-2">└── ...</span>
</code><button>Copy</button></pre>

<h3 id="key-components" class="tsd-anchor-link">Key Components<a href="#key-components" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3>
<h4 id="1-test-pages-" class="tsd-anchor-link">1. Test Pages (<code>pages/*.html</code>)<a href="#1-test-pages-" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4>
<p>Individual HTML pages that implement specific test scenarios. Each page:</p>
<ul>
<li>Loads the Content Scope Scripts</li>
<li>Defines test cases using the <code>test()</code> function</li>
<li>Validates expected outcomes against actual results</li>
<li>Renders results in a standardized format</li>
</ul>
<h4 id="2-configuration-files-" class="tsd-anchor-link">2. Configuration Files (<code>config/*.json</code>)<a href="#2-configuration-files-" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4>
<p>JSON files that define feature configurations for testing:</p>
<ul>
<li>Feature states (enabled/disabled)</li>
<li>Settings and parameters</li>
<li>Conditional logic and exceptions</li>
<li>Platform-specific configurations</li>
</ul>
<h4 id="3-shared-utilities-" class="tsd-anchor-link">3. Shared Utilities (<code>shared/utils.js</code>)<a href="#3-shared-utilities-" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4>
<p>Provides the testing framework:</p>
<ul>
<li><code>test(name, testFunction)</code> - Define test cases</li>
<li><code>renderResults()</code> - Execute tests and display results</li>
<li>Result collection and validation</li>
<li>Automation support for CI environments</li>
</ul>
<h2 id="how-it-works" class="tsd-anchor-link">How It Works<a href="#how-it-works" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2>
<h3 id="test-execution-flow" class="tsd-anchor-link">Test Execution Flow<a href="#test-execution-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3>
<ol>
<li><strong>Page Loading</strong>: Test pages are loaded with Content Scope Scripts injected</li>
<li><strong>Configuration Application</strong>: Feature configurations are applied based on the test scenario</li>
<li><strong>Test Execution</strong>: Individual test cases run and validate expected outcomes</li>
<li><strong>Result Collection</strong>: Results are collected and displayed in a standardized format</li>
<li><strong>Validation</strong>: CI systems validate that all tests pass across different platforms</li>
</ol>
<h3 id="example-test-page" class="tsd-anchor-link">Example Test Page<a href="#example-test-page" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3>
<pre><code class="html"><span class="hl-13">&lt;!</span><span class="hl-14">DOCTYPE</span><span class="hl-2"> </span><span class="hl-15">html</span><span class="hl-13">&gt;</span><br/><span class="hl-13">&lt;</span><span class="hl-14">html</span><span class="hl-13">&gt;</span><br/><span class="hl-2">    </span><span class="hl-13">&lt;</span><span class="hl-14">head</span><span class="hl-13">&gt;</span><br/><span class="hl-2">        </span><span class="hl-13">&lt;</span><span class="hl-14">title</span><span class="hl-13">&gt;</span><span class="hl-2">Conditional Matching Test</span><span class="hl-13">&lt;/</span><span class="hl-14">title</span><span class="hl-13">&gt;</span><br/><span class="hl-2">        </span><span class="hl-13">&lt;</span><span class="hl-14">link</span><span class="hl-2"> </span><span class="hl-15">rel</span><span class="hl-2">=</span><span class="hl-16">&quot;stylesheet&quot;</span><span class="hl-2"> </span><span class="hl-15">href</span><span class="hl-2">=</span><span class="hl-16">&quot;../../shared/style.css&quot;</span><span class="hl-2"> </span><span class="hl-13">/&gt;</span><br/><span class="hl-2">    </span><span class="hl-13">&lt;/</span><span class="hl-14">head</span><span class="hl-13">&gt;</span><br/><span class="hl-2">    </span><span class="hl-13">&lt;</span><span class="hl-14">body</span><span class="hl-13">&gt;</span><br/><span class="hl-2">        </span><span class="hl-13">&lt;</span><span class="hl-14">script</span><span class="hl-9"> </span><span class="hl-15">src</span><span class="hl-9">=</span><span class="hl-16">&quot;../../shared/utils.js&quot;</span><span class="hl-13">&gt;&lt;/</span><span class="hl-14">script</span><span class="hl-13">&gt;</span><br/><br/><span class="hl-2">        </span><span class="hl-13">&lt;</span><span class="hl-14">script</span><span class="hl-13">&gt;</span><br/><span class="hl-9">            </span><span class="hl-3">test</span><span class="hl-9">(</span><span class="hl-7">&#39;Conditional matching&#39;</span><span class="hl-9">, </span><span class="hl-1">async</span><span class="hl-9"> () </span><span class="hl-1">=&gt;</span><span class="hl-9"> {</span><br/><span class="hl-9">                </span><span class="hl-1">const</span><span class="hl-9"> </span><span class="hl-5">results</span><span class="hl-9"> </span><span class="hl-2">=</span><span class="hl-9"> [</span><br/><span class="hl-9">                    {</span><br/><span class="hl-9">                        </span><span class="hl-4">name:</span><span class="hl-9"> </span><span class="hl-7">&#39;APIs changing, expecting to always match&#39;</span><span class="hl-9">,</span><br/><span class="hl-9">                        </span><span class="hl-4">result:</span><span class="hl-9"> </span><span class="hl-4">navigator</span><span class="hl-9">.</span><span class="hl-4">hardwareConcurrency</span><span class="hl-9">,</span><br/><span class="hl-9">                        </span><span class="hl-4">expected:</span><span class="hl-9"> </span><span class="hl-11">222</span><span class="hl-9">,</span><br/><span class="hl-9">                    },</span><br/><span class="hl-9">                ];</span><br/><br/><span class="hl-9">                </span><span class="hl-0">// Test logic here...</span><br/><br/><span class="hl-9">                </span><span class="hl-6">return</span><span class="hl-9"> </span><span class="hl-4">results</span><span class="hl-9">;</span><br/><span class="hl-9">            });</span><br/><br/><span class="hl-9">            </span><span class="hl-3">renderResults</span><span class="hl-9">();</span><br/><span class="hl-9">        </span><span class="hl-13">&lt;/</span><span class="hl-14">script</span><span class="hl-13">&gt;</span><br/><span class="hl-2">    </span><span class="hl-13">&lt;/</span><span class="hl-14">body</span><span class="hl-13">&gt;</span><br/><span class="hl-13">&lt;/</span><span class="hl-14">html</span><span class="hl-13">&gt;</span>
</code><button type="button">Copy</button></pre>

<h3 id="example-configuration" class="tsd-anchor-link">Example Configuration<a href="#example-configuration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3>
<pre><code class="json"><span class="hl-2">{</span><br/><span class="hl-2">    </span><span class="hl-10">&quot;readme&quot;</span><span class="hl-2">: </span><span class="hl-7">&quot;This config tests conditional matching of experiments&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-10">&quot;version&quot;</span><span class="hl-2">: </span><span class="hl-11">1</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-10">&quot;features&quot;</span><span class="hl-2">: {</span><br/><span class="hl-2">        </span><span class="hl-10">&quot;apiManipulation&quot;</span><span class="hl-2">: {</span><br/><span class="hl-2">            </span><span class="hl-10">&quot;state&quot;</span><span class="hl-2">: </span><span class="hl-7">&quot;enabled&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">            </span><span class="hl-10">&quot;settings&quot;</span><span class="hl-2">: {</span><br/><span class="hl-2">                </span><span class="hl-10">&quot;apiChanges&quot;</span><span class="hl-2">: {</span><br/><span class="hl-2">                    </span><span class="hl-10">&quot;Navigator.prototype.hardwareConcurrency&quot;</span><span class="hl-2">: {</span><br/><span class="hl-2">                        </span><span class="hl-10">&quot;type&quot;</span><span class="hl-2">: </span><span class="hl-7">&quot;descriptor&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">                        </span><span class="hl-10">&quot;getterValue&quot;</span><span class="hl-2">: {</span><br/><span class="hl-2">                            </span><span class="hl-10">&quot;type&quot;</span><span class="hl-2">: </span><span class="hl-7">&quot;number&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">                            </span><span class="hl-10">&quot;value&quot;</span><span class="hl-2">: </span><span class="hl-11">222</span><br/><span class="hl-2">                        }</span><br/><span class="hl-2">                    }</span><br/><span class="hl-2">                },</span><br/><span class="hl-2">                </span><span class="hl-10">&quot;conditionalChanges&quot;</span><span class="hl-2">: [</span><br/><span class="hl-2">                    {</span><br/><span class="hl-2">                        </span><span class="hl-10">&quot;condition&quot;</span><span class="hl-2">: {</span><br/><span class="hl-2">                            </span><span class="hl-10">&quot;urlPattern&quot;</span><span class="hl-2">: </span><span class="hl-7">&quot;/test/*&quot;</span><br/><span class="hl-2">                        },</span><br/><span class="hl-2">                        </span><span class="hl-10">&quot;patchSettings&quot;</span><span class="hl-2">: [</span><br/><span class="hl-2">                            {</span><br/><span class="hl-2">                                </span><span class="hl-10">&quot;op&quot;</span><span class="hl-2">: </span><span class="hl-7">&quot;replace&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">                                </span><span class="hl-10">&quot;path&quot;</span><span class="hl-2">: </span><span class="hl-7">&quot;/apiChanges/Navigator.prototype.hardwareConcurrency/getterValue/value&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">                                </span><span class="hl-10">&quot;value&quot;</span><span class="hl-2">: </span><span class="hl-11">333</span><br/><span class="hl-2">                            }</span><br/><span class="hl-2">                        ]</span><br/><span class="hl-2">                    }</span><br/><span class="hl-2">                ]</span><br/><span class="hl-2">            }</span><br/><span class="hl-2">        }</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>Tip</strong>: The <code>apiManipulation</code> feature is particularly useful for testing config conditions because it modifies browser APIs in predictable ways. You can use it to validate that conditional logic, URL patterns, and other config conditions are being applied correctly by checking if the expected API values are returned.</p>
<h2 id="platform-integration" class="tsd-anchor-link">Platform Integration<a href="#platform-integration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2>
<h3 id="cross-platform-testing" class="tsd-anchor-link">Cross-Platform Testing<a href="#cross-platform-testing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3>
<p>The test pages are designed to work across multiple platforms:</p>
<ul>
<li><strong>Browser Extensions</strong>: Tests run in extension context with injected content scripts</li>
<li><strong>Android</strong>: Tests run in WebView with platform-specific messaging</li>
<li><strong>Apple</strong>: Tests run in WKWebView with WebKit-specific implementations</li>
<li><strong>Windows</strong>: Tests run with Windows-specific global polyfills</li>
</ul>
<h3 id="platform-specific-handling" class="tsd-anchor-link">Platform-Specific Handling<a href="#platform-specific-handling" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3>
<p>The test framework automatically handles platform differences through the <code>ResultsCollector</code> class, which applies appropriate setup and polyfills for each platform during test execution.</p>
<h2 id="running-tests" class="tsd-anchor-link">Running Tests<a href="#running-tests" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2>
<h3 id="local-development" class="tsd-anchor-link">Local Development<a href="#local-development" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3>
<ol>
<li>
<p><strong>Start the test server</strong>:</p>
<pre><code class="bash"><span class="hl-3">npm</span><span class="hl-2"> </span><span class="hl-7">run</span><span class="hl-2"> </span><span class="hl-7">serve</span>
</code><button type="button">Copy</button></pre>

</li>
<li>
<p><strong>Access test pages</strong>:</p>
<ul>
<li>Navigate to <code>http://localhost:3220/</code> for the main index</li>
<li>Browse to specific test categories and pages</li>
</ul>
</li>
</ol>
<h3 id="ci-integration" class="tsd-anchor-link">CI Integration<a href="#ci-integration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3>
<p>Tests are ran in CI environments:</p>
<pre><code class="javascript"><span class="hl-0">// Example CI test</span><br/><span class="hl-3">test</span><span class="hl-2">(</span><span class="hl-7">&#39;Test infra&#39;</span><span class="hl-2">, </span><span class="hl-1">async</span><span class="hl-2"> ({ </span><span class="hl-4">page</span><span class="hl-2"> }, </span><span class="hl-4">testInfo</span><span class="hl-2">) </span><span class="hl-1">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-6">await</span><span class="hl-2"> </span><span class="hl-3">testPage</span><span class="hl-2">(</span><br/><span class="hl-2">        </span><span class="hl-4">page</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-4">testInfo</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-7">&#39;/infra/pages/conditional-matching.html&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-7">&#39;./integration-test/test-pages/infra/config/conditional-matching.json&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">    );</span><br/><span class="hl-2">});</span>
</code><button type="button">Copy</button></pre>

<p>See <a href="../media/pages.spec.js">pages.spec.js</a> for complete CI test examples.</p>
<h2 id="testing-best-practices" class="tsd-anchor-link">Testing Best Practices<a href="#testing-best-practices" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2>
<p>When writing integration tests, follow these important guidelines:</p>
<h3 id="1-avoid-custom-state-in-spec-files" class="tsd-anchor-link">1. Avoid Custom State in Spec Files<a href="#1-avoid-custom-state-in-spec-files" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3>
<p>It's unadvisable to add custom state for tests directly in <code>.spec.js</code> files as it makes validation difficult and reduces test reliability. If custom state is absolutely required, ensure this is clearly explained in the corresponding test HTML file with detailed comments about what state is being set and why it's necessary.</p>
<h3 id="2-platform-configuration" class="tsd-anchor-link">2. Platform Configuration<a href="#2-platform-configuration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3>
<p>The <code>Platform</code> parameter can be passed to test functions to simulate different platform environments. This is demonstrated in the version tests in <a href="../media/pages.spec.js">pages.spec.js</a>:</p>
<ul>
<li><code>minSupportedVersion (string)</code>: Uses <code>{ version: '1.5.0' }</code></li>
<li><code>minSupportedVersion (int)</code>: Uses <code>{ version: 99 }</code></li>
<li><code>maxSupportedVersion (string)</code>: Uses <code>{ version: '1.5.0' }</code></li>
<li><code>maxSupportedVersion (int)</code>: Uses <code>{ version: 99 }</code></li>
</ul>
<p>This is needed when testing features that have platform-specific behavior or version requirements. The platform object allows testing how features behave under different version constraints without modifying the core test infrastructure.</p>
<h3 id="3-config-driven-testing" class="tsd-anchor-link">3. Config-Driven Testing<a href="#3-config-driven-testing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3>
<p>Where possible, prefer purely config-driven testing to validate features. This approach:</p>
<ul>
<li>Makes tests more maintainable and readable</li>
<li>Reduces coupling between test logic and implementation details</li>
<li>Allows for easier test data management and updates</li>
<li>Provides better separation of concerns between test setup and validation</li>
</ul>
<p>For detailed testing guidelines and examples, see the <a href="../media/pages.spec.js#L7">IMPORTANT TESTING GUIDELINES section</a> in the pages.spec.js file.</p>
<h2 id="interactive-and-automation-modes" class="tsd-anchor-link">Interactive and Automation Modes<a href="#interactive-and-automation-modes" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2>
<h3 id="interactive-mode" class="tsd-anchor-link">Interactive Mode<a href="#interactive-mode" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3>
<ul>
<li>When the test page is loaded <strong>without</strong> <code>?automation=true</code> in the URL, a <strong>&quot;Run Tests&quot; button</strong> appears at the top of the page.</li>
<li>This allows a human tester or a platform test harness to decide when to start the tests, rather than running them immediately on page load.</li>
<li>Clicking the button will execute all defined tests and display the results.</li>
</ul>
<h3 id="automation-mode" class="tsd-anchor-link">Automation Mode<a href="#automation-mode" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3>
<ul>
<li>When the test page is loaded <strong>with</strong> <code>?automation=true</code> in the URL, tests will run automatically as soon as the Content Scope Scripts are initialized.</li>
<li>This is used for CI and automated testing environments.</li>
<li>Tests wait for Content Scope Scripts initialization</li>
<li>Results are collected programmatically</li>
<li>Standardized result format for validation</li>
</ul>
<h2 id="result-reporting-and-visual-validation" class="tsd-anchor-link">Result Reporting and Visual Validation<a href="#result-reporting-and-visual-validation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2>
<ul>
<li>After the tests finish, the results are assigned to <code>window.results</code> as a standardized object.</li>
<li>The results are also rendered as an HTML table on the page, with pass/fail indicators for each test case.</li>
<li>This visual output can be used by visual testing tools (such as Maestro) to validate that the test run is complete and that all tests have passed.</li>
<li>The test suite status is also displayed at the top of the page, showing &quot;pass&quot; or &quot;fail&quot; for the overall run.</li>
</ul>
<h2 id="result-format" class="tsd-anchor-link">Result Format<a href="#result-format" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2>
<p>Tests return results in a standardized format:</p>
<pre><code class="javascript"><span class="hl-2">{</span><br/><span class="hl-2">    </span><span class="hl-7">&quot;Test Name&quot;</span><span class="hl-2">: [</span><br/><span class="hl-2">        {</span><br/><span class="hl-2">            </span><span class="hl-7">&quot;name&quot;</span><span class="hl-4">:</span><span class="hl-2"> </span><span class="hl-7">&quot;Specific test case&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">            </span><span class="hl-7">&quot;result&quot;</span><span class="hl-4">:</span><span class="hl-2"> </span><span class="hl-7">&quot;actual value&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">            </span><span class="hl-7">&quot;expected&quot;</span><span class="hl-4">:</span><span class="hl-2"> </span><span class="hl-7">&quot;expected value&quot;</span><br/><span class="hl-2">        }</span><br/><span class="hl-2">    ]</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<p>Results are displayed in HTML tables with pass/fail indicators and can be collected programmatically for CI validation.</p>
<h2 id="best-practices" class="tsd-anchor-link">Best Practices<a href="#best-practices" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2>
<h3 id="creating-index-pages" class="tsd-anchor-link">Creating Index Pages<a href="#creating-index-pages" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3>
<p>When creating a new feature directory in the test pages system, it's best practice to include an <code>index.html</code> file that serves as a navigation hub for that feature's tests. This provides several benefits:</p>
<ol>
<li><strong>Easy Navigation</strong>: Developers can quickly browse available tests without digging through subdirectories</li>
<li><strong>Clear Organization</strong>: Each feature directory has a consistent entry point</li>
<li><strong>Documentation</strong>: The index page can include descriptions of what the feature tests cover</li>
<li><strong>Maintainability</strong>: Makes it easier for new team members to understand the test structure</li>
</ol>
<h4 id="index-page-template" class="tsd-anchor-link">Index Page Template<a href="#index-page-template" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4>
<pre><code class="html"><span class="hl-13">&lt;!</span><span class="hl-14">DOCTYPE</span><span class="hl-2"> </span><span class="hl-15">html</span><span class="hl-13">&gt;</span><br/><span class="hl-13">&lt;</span><span class="hl-14">html</span><span class="hl-13">&gt;</span><br/><span class="hl-2">    </span><span class="hl-13">&lt;</span><span class="hl-14">head</span><span class="hl-13">&gt;</span><br/><span class="hl-2">        </span><span class="hl-13">&lt;</span><span class="hl-14">meta</span><span class="hl-2"> </span><span class="hl-15">charset</span><span class="hl-2">=</span><span class="hl-16">&quot;utf-8&quot;</span><span class="hl-2"> </span><span class="hl-13">/&gt;</span><br/><span class="hl-2">        </span><span class="hl-13">&lt;</span><span class="hl-14">meta</span><span class="hl-2"> </span><span class="hl-15">name</span><span class="hl-2">=</span><span class="hl-16">&quot;viewport&quot;</span><span class="hl-2"> </span><span class="hl-15">content</span><span class="hl-2">=</span><span class="hl-16">&quot;width=device-width&quot;</span><span class="hl-2"> </span><span class="hl-13">/&gt;</span><br/><span class="hl-2">        </span><span class="hl-13">&lt;</span><span class="hl-14">title</span><span class="hl-13">&gt;</span><span class="hl-2">Feature Name</span><span class="hl-13">&lt;/</span><span class="hl-14">title</span><span class="hl-13">&gt;</span><br/><span class="hl-2">    </span><span class="hl-13">&lt;/</span><span class="hl-14">head</span><span class="hl-13">&gt;</span><br/><span class="hl-2">    </span><span class="hl-13">&lt;</span><span class="hl-14">body</span><span class="hl-13">&gt;</span><br/><span class="hl-2">        </span><span class="hl-13">&lt;</span><span class="hl-14">p</span><span class="hl-13">&gt;&lt;</span><span class="hl-14">a</span><span class="hl-2"> </span><span class="hl-15">href</span><span class="hl-2">=</span><span class="hl-16">&quot;../index.html&quot;</span><span class="hl-13">&gt;</span><span class="hl-2">[Home]</span><span class="hl-13">&lt;/</span><span class="hl-14">a</span><span class="hl-13">&gt;&lt;/</span><span class="hl-14">p</span><span class="hl-13">&gt;</span><br/><br/><span class="hl-2">        </span><span class="hl-13">&lt;</span><span class="hl-14">p</span><span class="hl-13">&gt;</span><span class="hl-2">Feature Name</span><span class="hl-13">&lt;/</span><span class="hl-14">p</span><span class="hl-13">&gt;</span><br/><span class="hl-2">        </span><span class="hl-13">&lt;</span><span class="hl-14">ul</span><span class="hl-13">&gt;</span><br/><span class="hl-2">            </span><span class="hl-13">&lt;</span><span class="hl-14">li</span><span class="hl-13">&gt;&lt;</span><span class="hl-14">a</span><span class="hl-2"> </span><span class="hl-15">href</span><span class="hl-2">=</span><span class="hl-16">&quot;./pages/test-page-1.html&quot;</span><span class="hl-13">&gt;</span><span class="hl-2">Test Page 1</span><span class="hl-13">&lt;/</span><span class="hl-14">a</span><span class="hl-13">&gt;&lt;/</span><span class="hl-14">li</span><span class="hl-13">&gt;</span><br/><span class="hl-2">            </span><span class="hl-13">&lt;</span><span class="hl-14">li</span><span class="hl-13">&gt;&lt;</span><span class="hl-14">a</span><span class="hl-2"> </span><span class="hl-15">href</span><span class="hl-2">=</span><span class="hl-16">&quot;./pages/test-page-2.html&quot;</span><span class="hl-13">&gt;</span><span class="hl-2">Test Page 2</span><span class="hl-13">&lt;/</span><span class="hl-14">a</span><span class="hl-13">&gt;&lt;/</span><span class="hl-14">li</span><span class="hl-13">&gt;</span><br/><span class="hl-2">        </span><span class="hl-13">&lt;/</span><span class="hl-14">ul</span><span class="hl-13">&gt;</span><br/><span class="hl-2">    </span><span class="hl-13">&lt;/</span><span class="hl-14">body</span><span class="hl-13">&gt;</span><br/><span class="hl-13">&lt;/</span><span class="hl-14">html</span><span class="hl-13">&gt;</span>
</code><button type="button">Copy</button></pre>

<h4 id="key-elements" class="tsd-anchor-link">Key Elements<a href="#key-elements" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4>
<ul>
<li><strong>Navigation Link</strong>: Always include a link back to the parent index page</li>
<li><strong>Feature Title</strong>: Clear heading indicating what feature is being tested</li>
<li><strong>Test Links</strong>: Organized list of all test pages in the <code>pages/</code> subdirectory</li>
<li><strong>Consistent Structure</strong>: Follow the same pattern as existing feature directories</li>
</ul>
<h3 id="writing-test-pages" class="tsd-anchor-link">Writing Test Pages<a href="#writing-test-pages" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3>
<ol>
<li><strong>Use descriptive test names</strong> that clearly indicate what is being tested</li>
<li><strong>Include multiple test cases</strong> to cover different scenarios and edge cases</li>
<li><strong>Use realistic test data</strong> that mimics real-world usage</li>
<li><strong>Include proper cleanup</strong> for tests that modify state</li>
</ol>
<h3 id="writing-configurations" class="tsd-anchor-link">Writing Configurations<a href="#writing-configurations" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3>
<ol>
<li><strong>Document the purpose</strong> in the <code>readme</code> field</li>
<li><strong>Use semantic feature names</strong> that match the codebase</li>
<li><strong>Include platform-specific configurations</strong> when needed</li>
<li><strong>Keep configurations focused</strong> on specific test scenarios</li>
</ol>
<h3 id="platform-compatibility" class="tsd-anchor-link">Platform Compatibility<a href="#platform-compatibility" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3>
<ol>
<li><strong>Test across all platforms</strong> to ensure consistency</li>
<li><strong>Handle platform-specific APIs</strong> appropriately</li>
<li><strong>Use platform-agnostic test logic</strong> when possible</li>
<li><strong>Validate messaging interfaces</strong> work correctly</li>
<li><strong>Test fallback behaviors</strong> for unsupported features</li>
</ol>
<h2 id="integration-with-privacy-test-pages" class="tsd-anchor-link">Integration with Privacy Test Pages<a href="#integration-with-privacy-test-pages" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2>
<p>The test pages are hosted at <a href="https://privacy-test-pages.site/">https://privacy-test-pages.site/</a> and used by DuckDuckGo clients, platform teams, CI systems, and external developers to ensure consistent functionality across all platforms.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h3>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h3>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#test-pages-guide"><span>Test <wbr/>Pages <wbr/>Guide</span></a><ul><li><a href="#overview"><span>Overview</span></a></li><li><a href="#architecture"><span>Architecture</span></a></li><li><ul><li><a href="#directory-structure"><span>Directory <wbr/>Structure</span></a></li><li><a href="#key-components"><span>Key <wbr/>Components</span></a></li><li><ul><li><a href="#1-test-pages-"><span>1. <wbr/>Test <wbr/>Pages ()</span></a></li><li><a href="#2-configuration-files-"><span>2. <wbr/>Configuration <wbr/>Files ()</span></a></li><li><a href="#3-shared-utilities-"><span>3. <wbr/>Shared <wbr/>Utilities ()</span></a></li></ul></li></ul></li><li><a href="#how-it-works"><span>How <wbr/>It <wbr/>Works</span></a></li><li><ul><li><a href="#test-execution-flow"><span>Test <wbr/>Execution <wbr/>Flow</span></a></li><li><a href="#example-test-page"><span>Example <wbr/>Test <wbr/>Page</span></a></li><li><a href="#example-configuration"><span>Example <wbr/>Configuration</span></a></li></ul></li><li><a href="#platform-integration"><span>Platform <wbr/>Integration</span></a></li><li><ul><li><a href="#cross-platform-testing"><span>Cross-<wbr/>Platform <wbr/>Testing</span></a></li><li><a href="#platform-specific-handling"><span>Platform-<wbr/>Specific <wbr/>Handling</span></a></li></ul></li><li><a href="#running-tests"><span>Running <wbr/>Tests</span></a></li><li><ul><li><a href="#local-development"><span>Local <wbr/>Development</span></a></li><li><a href="#ci-integration"><span>CI <wbr/>Integration</span></a></li></ul></li><li><a href="#testing-best-practices"><span>Testing <wbr/>Best <wbr/>Practices</span></a></li><li><ul><li><a href="#1-avoid-custom-state-in-spec-files"><span>1. <wbr/>Avoid <wbr/>Custom <wbr/>State in <wbr/>Spec <wbr/>Files</span></a></li><li><a href="#2-platform-configuration"><span>2. <wbr/>Platform <wbr/>Configuration</span></a></li><li><a href="#3-config-driven-testing"><span>3. <wbr/>Config-<wbr/>Driven <wbr/>Testing</span></a></li></ul></li><li><a href="#interactive-and-automation-modes"><span>Interactive and <wbr/>Automation <wbr/>Modes</span></a></li><li><ul><li><a href="#interactive-mode"><span>Interactive <wbr/>Mode</span></a></li><li><a href="#automation-mode"><span>Automation <wbr/>Mode</span></a></li></ul></li><li><a href="#result-reporting-and-visual-validation"><span>Result <wbr/>Reporting and <wbr/>Visual <wbr/>Validation</span></a></li><li><a href="#result-format"><span>Result <wbr/>Format</span></a></li><li><a href="#best-practices"><span>Best <wbr/>Practices</span></a></li><li><ul><li><a href="#creating-index-pages"><span>Creating <wbr/>Index <wbr/>Pages</span></a></li><li><ul><li><a href="#index-page-template"><span>Index <wbr/>Page <wbr/>Template</span></a></li><li><a href="#key-elements"><span>Key <wbr/>Elements</span></a></li></ul></li><li><a href="#writing-test-pages"><span>Writing <wbr/>Test <wbr/>Pages</span></a></li><li><a href="#writing-configurations"><span>Writing <wbr/>Configurations</span></a></li><li><a href="#platform-compatibility"><span>Platform <wbr/>Compatibility</span></a></li></ul></li><li><a href="#integration-with-privacy-test-pages"><span>Integration with <wbr/>Privacy <wbr/>Test <wbr/>Pages</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../index.html">@duckduckgo/content-scope-scripts</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
